const a1_0x2225=['maskedProperties','value','../../terminal-output/message-reporter','error','note','E2EEncryption','subscribe','../../terminal-output/end-of-run-message','removeTrailingSlash','getBranch','join','push','assign','../../file-storage/e2e-encryption','throw','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20record\x20its\x20run.','endRun','getCIExecutionId','ACCESS_TOKEN','waitForStoreRequestsToComplete','writeFileSync','printMessages','printCacheHitsMessage','../../../utilities/remove-trailing-slash','ENCRYPTION_KEY','https://nx.app','toString','OutputObfuscator','hash','getCIExecutionEnv','parseCommand','next','skipNxCache','accessToken','.commit','../../../utilities/environment','./cloud-remote-cache','requests','./cloud-run.api','path','filter','getMachineInfo','fs-extra','catch','CloudRemoteCache','enabled','getRunGroup','defineProperty','DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE','Task\x20with\x20hash\x20','anyErrors','storedHashes','cloudEnabledTasksRunner','NX_CLOUD_DISTRIBUTED_EXECUTION_ID','daemon','cacheableOperations','local-cache-hit','warn','forEach','../../../utilities/nx-imports','ErrorReporterApi','length','cloud-enabled-runner','processInBackground','map','extractGitSha','taskId','pathExists','message','EndOfRunMessage','./id-generator','url','Executed\x20tasks\x20with\x20hashes:\x20','toISOString','__esModule','startRun','exit','then','all','../../../utilities/metric-logger','lifeCycle','encryptionKey','tasks-hashes-','env','find','./cloud-enabled-life-cycle','agentRunningInDistributedExecution','store','MessageReporter','\x20isn\x27t\x20recorded','complete','Nx\x20Cloud\x20wasn\x27t\x20able\x20to\x20store\x20artifacts.','../../terminal-output/output-obfuscator'];(function(_0x22d80a,_0x222528){const _0x3b84dc=function(_0x5eecf1){while(--_0x5eecf1){_0x22d80a['push'](_0x22d80a['shift']());}};_0x3b84dc(++_0x222528);}(a1_0x2225,0xf6));const a1_0x3b84=function(_0x22d80a,_0x222528){_0x22d80a=_0x22d80a-0x0;let _0x3b84dc=a1_0x2225[_0x22d80a];return _0x3b84dc;};'use strict';var __awaiter=this&&this['__awaiter']||function(_0x10dbdb,_0x229dda,_0x8ea7d5,_0x221352){function _0x4c58c2(_0x2bbd7e){return _0x2bbd7e instanceof _0x8ea7d5?_0x2bbd7e:new _0x8ea7d5(function(_0x4b8542){_0x4b8542(_0x2bbd7e);});}return new(_0x8ea7d5||(_0x8ea7d5=Promise))(function(_0x2ba64c,_0x355af1){function _0x4f88c8(_0x129752){try{_0x4726b6(_0x221352[a1_0x3b84('0x40')](_0x129752));}catch(_0x273c05){_0x355af1(_0x273c05);}}function _0x104507(_0x4fbace){try{_0x4726b6(_0x221352[a1_0x3b84('0x2f')](_0x4fbace));}catch(_0x39b330){_0x355af1(_0x39b330);}}function _0x4726b6(_0x15cbcc){_0x15cbcc['done']?_0x2ba64c(_0x15cbcc[a1_0x3b84('0x22')]):_0x4c58c2(_0x15cbcc[a1_0x3b84('0x22')])[a1_0x3b84('0x11')](_0x4f88c8,_0x104507);}_0x4726b6((_0x221352=_0x221352['apply'](_0x10dbdb,_0x229dda||[]))[a1_0x3b84('0x40')]());});};Object[a1_0x3b84('0x50')](exports,a1_0x3b84('0xe'),{'value':!![]});exports[a1_0x3b84('0x55')]=void 0x0;const message_reporter_1=require(a1_0x3b84('0x23'));const end_of_run_message_1=require(a1_0x3b84('0x28'));const output_obfuscator_1=require(a1_0x3b84('0x20'));const cloud_enabled_life_cycle_1=require(a1_0x3b84('0x19'));const file_storage_1=require('../../file-storage/file-storage');const e2e_encryption_1=require(a1_0x3b84('0x2e'));const environment_1=require(a1_0x3b84('0x44'));const cloud_remote_cache_1=require(a1_0x3b84('0x45'));const cloud_run_api_1=require(a1_0x3b84('0x47'));const fs_1=require('fs');const path=require(a1_0x3b84('0x48'));const path_1=require('path');const metric_logger_1=require(a1_0x3b84('0x13'));const error_reporter_api_1=require('../../api/error-reporter.api');const fs_extra_1=require(a1_0x3b84('0x4b'));const id_generator_1=require(a1_0x3b84('0xa'));const remove_trailing_slash_1=require(a1_0x3b84('0x38'));const {tasksRunner,output,cacheDirectory}=require(a1_0x3b84('0x5c'));function createApi(_0x2cc7b9,_0x3a8bd3,_0x214eb5){const _0x3749d0=(0x0,environment_1[a1_0x3b84('0x4a')])(_0x3a8bd3);return new cloud_run_api_1['CloudRunApi'](_0x2cc7b9,_0x214eb5,_0x3a8bd3,_0x3749d0);}function storeTaskHashes(_0x2b189f,_0x40d740,_0x76813a){const _0xf1bd7b=JSON['stringify'](_0x2b189f[a1_0x3b84('0x4')](_0x28f399=>({'taskId':_0x28f399[a1_0x3b84('0x6')],'hash':_0x28f399[a1_0x3b84('0x3d')]})));if(environment_1['VERBOSE_LOGGING']){output[a1_0x3b84('0x25')]({'title':a1_0x3b84('0xc')+_0xf1bd7b});}(0x0,fs_1[a1_0x3b84('0x35')])(path[a1_0x3b84('0x2b')](_0x40d740,a1_0x3b84('0x16')+_0x76813a),_0xf1bd7b);}function storeLocalCacheHits(_0x33fdbd,_0x465f74,_0x4719a9){const _0x15c79f=_0x33fdbd[a1_0x3b84('0x49')](_0x230390=>_0x230390['cacheStatus']===a1_0x3b84('0x59'))['map'](_0x4452e1=>_0x4452e1['hash']);_0x15c79f[a1_0x3b84('0x5b')](_0x392d33=>_0x465f74[a1_0x3b84('0x1b')](_0x392d33,_0x4719a9));}function onComplete({daemon,options,fileStorage,remoteCache,api,outputObfuscator,runStartTime,messages,endOfRunMessage,taskExecutions,versionOfNxBefore133,inner,encryptionKey,storeInCurrentProcess,distributedExecutionId,runContext}){return __awaiter(this,void 0x0,void 0x0,function*(){const _0x1a684d=new Date()['toISOString']();const _0x1c0d21=(0x0,environment_1[a1_0x3b84('0x2a')])();const _0x37cd9d={'command':outputObfuscator['obfuscate']((0x0,environment_1[a1_0x3b84('0x3f')])()),'startTime':runStartTime,'endTime':_0x1a684d,'distributedExecutionId':distributedExecutionId,'branch':_0x1c0d21,'runGroup':(0x0,environment_1[a1_0x3b84('0x4f')])(),'sha':_0x1c0d21?(0x0,environment_1[a1_0x3b84('0x5')])():undefined,'inner':inner};const _0x199c53={'branch':_0x1c0d21,'runGroup':(0x0,environment_1[a1_0x3b84('0x4f')])(),'ciExecutionId':(0x0,environment_1[a1_0x3b84('0x32')])(),'ciExecutionEnv':(0x0,environment_1[a1_0x3b84('0x3e')])()};if(storeInCurrentProcess){if((0x0,environment_1[a1_0x3b84('0x1a')])(distributedExecutionId)){storeTaskHashes(taskExecutions,cacheDirectory,distributedExecutionId);storeLocalCacheHits(taskExecutions,remoteCache,cacheDirectory);}try{yield remoteCache[a1_0x3b84('0x34')]();}catch(_0x4d42e0){output[a1_0x3b84('0x24')]({'title':a1_0x3b84('0x1f')});messages['printMessages']();return![];}for(const _0x3a25f1 of fileStorage[a1_0x3b84('0x54')]){const _0x29c33b=taskExecutions[a1_0x3b84('0x18')](_0x53b564=>_0x53b564['hash']===_0x3a25f1);if(!_0x29c33b){throw new Error(a1_0x3b84('0x52')+_0x3a25f1+a1_0x3b84('0x1d'));}_0x29c33b['uploadedToStorage']=!![];}try{yield api[a1_0x3b84('0x31')](_0x37cd9d,taskExecutions,_0x199c53);}catch(_0x17bc9b){output[a1_0x3b84('0x24')]({'title':a1_0x3b84('0x30')});messages[a1_0x3b84('0x36')]();return![];}yield(0x0,metric_logger_1['submitRunMetrics'])(options);}else{try{const _0x537cf8=environment_1[a1_0x3b84('0x33')]?environment_1['ACCESS_TOKEN']:options[a1_0x3b84('0x42')];const _0x3ce64c=(0x0,id_generator_1['generateUniqueLinkId'])();yield daemon[a1_0x3b84('0x3')]('nx-cloud/lib/daemon/process-run-end',{'encryptionKey':encryptionKey,'runnerOptions':Object[a1_0x3b84('0x2d')](Object[a1_0x3b84('0x2d')]({},options),{'accessToken':_0x537cf8}),'delayedStoreRequests':remoteCache['delayedStoreRequests'],'ciExecutionContext':_0x199c53,'runEnd':{'runData':_0x37cd9d,'taskExecutions':taskExecutions,'linkId':_0x3ce64c}});runContext['runUrl']=(0x0,remove_trailing_slash_1[a1_0x3b84('0x29')])(options[a1_0x3b84('0xb')]||a1_0x3b84('0x3a'))+'/runs/'+_0x3ce64c;}catch(_0x4cb788){output[a1_0x3b84('0x5a')]({'title':'Nx\x20Cloud\x20Problems','bodyLines':[_0x4cb788[a1_0x3b84('0x8')]||_0x4cb788[a1_0x3b84('0x3b')]()]});return![];}}if(versionOfNxBefore133){setTimeout(()=>{messages[a1_0x3b84('0x36')]();if(!messages[a1_0x3b84('0x53')]&&!inner){endOfRunMessage[a1_0x3b84('0x37')]();}},0x0);}else{messages[a1_0x3b84('0x36')]();if(!messages[a1_0x3b84('0x53')]&&!inner){endOfRunMessage[a1_0x3b84('0x37')]();}}return!![];});}function createLifeCycle(_0x429651,_0x19e121,_0x49a1b3,_0x404e88){const _0x5ed0e9=new cloud_enabled_life_cycle_1['CloudEnabledLifeCycle'](_0x429651,cacheDirectory,!![],_0x19e121[a1_0x3b84('0x58')]||[],_0x49a1b3,_0x404e88);try{const {CompositeLifeCycle}=require(a1_0x3b84('0x5c'));if(!CompositeLifeCycle)return _0x5ed0e9;return new CompositeLifeCycle([_0x19e121[a1_0x3b84('0x14')],_0x5ed0e9]);}catch(_0x37f75a){return _0x5ed0e9;}}function fetchUrlsForKnownHashesUpfront(_0x569e61,_0x971dcc,_0x508270,_0x47c68a,_0x386413){return __awaiter(this,void 0x0,void 0x0,function*(){if(_0x47c68a[a1_0x3b84('0x41')])return;let _0x33ca03=_0x508270[a1_0x3b84('0x4')](_0x11879d=>_0x11879d[a1_0x3b84('0x3d')])[a1_0x3b84('0x49')](_0x4592c7=>!!_0x4592c7);const _0x53edfb=yield Promise[a1_0x3b84('0x12')](_0x33ca03[a1_0x3b84('0x4')](_0xd2f170=>{const _0xad612a=(0x0,path_1[a1_0x3b84('0x2b')])(cacheDirectory,_0xd2f170+a1_0x3b84('0x43'));return(0x0,fs_extra_1[a1_0x3b84('0x7')])(_0xad612a);}));const _0x4772ca=[];for(let _0x4db882=0x0;_0x4db882<_0x53edfb['length'];++_0x4db882){if(!_0x53edfb[_0x4db882]){_0x4772ca[a1_0x3b84('0x2c')](_0x33ca03[_0x4db882]);}}if(_0x4772ca[a1_0x3b84('0x1')]>0x0){const _0x10d448=_0x569e61[a1_0x3b84('0xf')](_0x386413,_0x4772ca);for(const _0x804462 of _0x4772ca){_0x971dcc[a1_0x3b84('0x46')][_0x804462]=_0x10d448;}}});}function cloudEnabledTasksRunner(_0x25b4df,_0x3d4315,_0x3ecb83,_0x902903=![]){var _0x46b7b4;const _0x5c0e26=process['env']['NX_CLOUD_DISTRIBUTED_EXECUTION_ID'];const _0x1c82ce={'statuses':{},'scheduledTasks':[],'requests':{},'allTasks':_0x25b4df};const _0x32ad01=_0x3d4315['lifeCycle']===undefined;const _0x3b0a1b=[];const _0x55498a=new message_reporter_1[(a1_0x3b84('0x1c'))](_0x3d4315);const _0xbefe79=createApi(_0x55498a,_0x3d4315,_0x1c82ce);const _0x31e910=new end_of_run_message_1[(a1_0x3b84('0x9'))](_0x1c82ce,_0x3b0a1b,_0x5c0e26);const _0x530178=new output_obfuscator_1[(a1_0x3b84('0x3c'))](_0x3d4315[a1_0x3b84('0x21')]);const _0x3d5548=new Date()[a1_0x3b84('0xd')]();const _0x5c0cac=createLifeCycle(_0x1c82ce,_0x3d4315,_0x530178,_0x3b0a1b);const _0x57f285=environment_1[a1_0x3b84('0x39')]||_0x3d4315[a1_0x3b84('0x15')];const _0x1e27d4=new e2e_encryption_1[(a1_0x3b84('0x26'))](_0x57f285);const _0x490688=new error_reporter_api_1[(a1_0x3b84('0x0'))](_0x3d4315);const _0x49b4c2=(0x0,environment_1[a1_0x3b84('0x1a')])(_0x5c0e26)||!((_0x46b7b4=_0x3ecb83[a1_0x3b84('0x57')])===null||_0x46b7b4===void 0x0?void 0x0:_0x46b7b4[a1_0x3b84('0x4e')]());const _0x41f560=new file_storage_1['FileStorage'](_0x1e27d4,_0x490688,_0x3d4315,a1_0x3b84('0x2'));const _0x24022c=new cloud_remote_cache_1[(a1_0x3b84('0x4d'))](_0x55498a,_0xbefe79,_0x1c82ce,_0x41f560,_0x5c0e26,_0x49b4c2);fetchUrlsForKnownHashesUpfront(_0xbefe79,_0x1c82ce,_0x25b4df,_0x3d4315,_0x5c0e26);delete process[a1_0x3b84('0x17')][a1_0x3b84('0x56')];const _0x24e737=tasksRunner(_0x25b4df,Object[a1_0x3b84('0x2d')](Object[a1_0x3b84('0x2d')]({},_0x3d4315),{'remoteCache':_0x24022c,'lifeCycle':_0x5c0cac}),_0x3ecb83);if(_0x24e737['subscribe']){const {Subject}=require('rxjs/internal/Subject');const _0x1040f2=new Subject();_0x24e737[a1_0x3b84('0x27')]({'next':_0x3c5964=>_0x1040f2[a1_0x3b84('0x40')](_0x3c5964),'error':_0x582cd1=>_0x1040f2[a1_0x3b84('0x24')](_0x582cd1),'complete':()=>__awaiter(this,void 0x0,void 0x0,function*(){const _0x392019=yield onComplete({'daemon':_0x3ecb83['daemon'],'options':_0x3d4315,'fileStorage':_0x41f560,'remoteCache':_0x24022c,'api':_0xbefe79,'outputObfuscator':_0x530178,'runStartTime':_0x3d5548,'messages':_0x55498a,'endOfRunMessage':_0x31e910,'taskExecutions':_0x3b0a1b,'versionOfNxBefore133':_0x32ad01,'inner':_0x902903,'encryptionKey':_0x57f285,'storeInCurrentProcess':_0x49b4c2,'runContext':_0x1c82ce,'distributedExecutionId':_0x5c0e26});if(!_0x392019&&(0x0,environment_1[a1_0x3b84('0x1a')])(_0x5c0e26)){process[a1_0x3b84('0x10')](environment_1[a1_0x3b84('0x51')]);}_0x1040f2[a1_0x3b84('0x1e')]();})});return _0x1040f2;}else{return _0x24e737[a1_0x3b84('0x11')](_0x205c38=>__awaiter(this,void 0x0,void 0x0,function*(){const _0x42d3b1=yield onComplete({'daemon':_0x3ecb83[a1_0x3b84('0x57')],'options':_0x3d4315,'fileStorage':_0x41f560,'remoteCache':_0x24022c,'api':_0xbefe79,'outputObfuscator':_0x530178,'runStartTime':_0x3d5548,'messages':_0x55498a,'endOfRunMessage':_0x31e910,'taskExecutions':_0x3b0a1b,'versionOfNxBefore133':_0x32ad01,'inner':_0x902903,'encryptionKey':_0x57f285,'storeInCurrentProcess':_0x49b4c2,'runContext':_0x1c82ce,'distributedExecutionId':_0x5c0e26});if(!_0x42d3b1&&(0x0,environment_1['agentRunningInDistributedExecution'])(_0x5c0e26)){process[a1_0x3b84('0x10')](environment_1[a1_0x3b84('0x51')]);}return _0x205c38;}))[a1_0x3b84('0x4c')](_0x200a5a=>__awaiter(this,void 0x0,void 0x0,function*(){const _0x200b1b=yield onComplete({'daemon':_0x3ecb83[a1_0x3b84('0x57')],'options':_0x3d4315,'fileStorage':_0x41f560,'remoteCache':_0x24022c,'api':_0xbefe79,'outputObfuscator':_0x530178,'runStartTime':_0x3d5548,'messages':_0x55498a,'endOfRunMessage':_0x31e910,'taskExecutions':_0x3b0a1b,'versionOfNxBefore133':_0x32ad01,'inner':_0x902903,'encryptionKey':_0x57f285,'storeInCurrentProcess':_0x49b4c2,'runContext':_0x1c82ce,'distributedExecutionId':_0x5c0e26});if(!_0x200b1b&&(0x0,environment_1[a1_0x3b84('0x1a')])(_0x5c0e26)){process[a1_0x3b84('0x10')](environment_1['DISTRIBUTED_TASK_EXECUTION_INTERNAL_ERROR_STATUS_CODE']);}throw _0x200a5a;}));}}exports[a1_0x3b84('0x55')]=cloudEnabledTasksRunner;