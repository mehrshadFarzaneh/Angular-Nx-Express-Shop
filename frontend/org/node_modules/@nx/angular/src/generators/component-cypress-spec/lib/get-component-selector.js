"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getComponentSelector = void 0;
const ensure_typescript_1 = require("@nx/js/src/utils/typescript/ensure-typescript");
const js_1 = require("@nx/js");
const ast_utils_1 = require("../../../utils/nx-devkit/ast-utils");
let tsModule;
function getComponentSelector(tree, path) {
    if (!tsModule) {
        tsModule = (0, ensure_typescript_1.ensureTypescript)();
    }
    const file = (0, ast_utils_1.getTsSourceFile)(tree, path);
    const componentDecorators = (0, ast_utils_1.getDecoratorMetadata)(file, 'Component', '@angular/core');
    if (componentDecorators.length === 0) {
        throw new Error(`No @Component decorator in ${path}.`);
    }
    const componentDecorator = componentDecorators[0];
    const selectorNode = ((0, js_1.findNodes)(componentDecorator, tsModule.SyntaxKind.PropertyAssignment).find((node) => node.name.getText() === 'selector'));
    if (!selectorNode) {
        throw new Error(`No selector defined for the component in ${path}.`);
    }
    return selectorNode.initializer.getText().slice(1, -1);
}
exports.getComponentSelector = getComponentSelector;
