"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateOptions = void 0;
const devkit_1 = require("@nx/devkit");
const path_1 = require("path");
const angular_version_utils_1 = require("../../executors/utilities/angular-version-utils");
function validateOptions(options) {
    const angularVersionInfo = (0, angular_version_utils_1.getInstalledAngularVersionInfo)();
    validatePolyfills(options, angularVersionInfo);
    validateStyles(options, angularVersionInfo);
}
exports.validateOptions = validateOptions;
function validatePolyfills(options, { major, version }) {
    if (major < 15 && Array.isArray(options.polyfills)) {
        throw new Error((0, devkit_1.stripIndents) `The array syntax for the "polyfills" option is supported from Angular >= 15.0.0. You are currently using "${version}".
      You can resolve this error by removing the "polyfills" option, setting it to a string value or migrating to Angular 15.0.0.`);
    }
}
function validateStyles(options, { major, version }) {
    if (!options.styles || !options.styles.length) {
        return;
    }
    if (major < 15) {
        return;
    }
    const stylusFiles = [];
    options.styles.forEach((style) => {
        const styleFile = typeof style === 'string' ? style : style.input;
        if ((0, path_1.extname)(styleFile) === '.styl') {
            stylusFiles.push(styleFile);
        }
    });
    if (stylusFiles.length) {
        throw new Error((0, devkit_1.stripIndents) `Stylus is not supported since Angular v15. You're currently using "${version}".
      You have the "styles" option with the following file(s) using the ".styl" extension: ${stylusFiles
            .map((x) => `"${x}"`)
            .join(', ')}.
      Make sure to convert them to a supported extension (".css", ".scss", ".sass", ".less").`);
    }
}
