"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const devkit_1 = require("@nx/devkit");
function default_1(tree) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        (0, devkit_1.updateJson)(tree, 'package.json', (json) => {
            var _a, _b;
            if (!((_b = (_a = json.scripts) === null || _a === void 0 ? void 0 : _a.postinstall) === null || _b === void 0 ? void 0 : _b.includes('ngcc '))) {
                return json;
            }
            json.scripts.postinstall = json.scripts.postinstall
                // special case when ngcc is at the start so we remove the && as well
                .replace(/^(ngcc.*?&& *)(.*)/, '$2')
                // everything else
                .replace(/(.*?)((&& *)?ngcc.*?)((?=&)|$)(.*)/, '$1$5')
                .trim();
            if (json.scripts.postinstall === '') {
                json.scripts.postinstall = undefined;
            }
            return json;
        });
        yield (0, devkit_1.formatFiles)(tree);
    });
}
exports.default = default_1;
