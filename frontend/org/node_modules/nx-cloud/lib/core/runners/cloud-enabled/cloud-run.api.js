const a3_0x135d=['post','extractErrorMessage','printDuration','RUNNER_FAILURE_PERF_ENTRY','message','done','gzip','zlib','__esModule','apiError','data','getRunGroup','toString','axiosException','apply','../../../utilities/is-private-cloud','axiosMultipleTries','nxCloudVersion','stringify','unknown','success','promisify','messages','assign','error','@nrwl/nx-cloud','runContext','nx-cloud','__awaiter','../../../utilities/nx-imports','note','map','recordMetric','createMetricRecorder','package.json','status','apiAxiosInstance','slice','getCIExecutionId','RunStart\x20duration','../../../utilities/metric-logger','then','terminalOutput','uploadedToStorage','RunEnd.\x20Completed\x20tasks','value','headers','util','/nx-cloud/runs/start','../../../utilities/axios','Stack\x20Trace:','createApiAxiosInstance','runUrl','RunStart','createReqBody','mapRespToPerfEntry','defineProperty','response','api','startRun','parse','Nx\x20Cloud:\x20Unknown\x20Error\x20Occurred','devDependencies','Invalid\x20end\x20run\x20response:\x20','application/octet-stream','VERBOSE_LOGGING','endRun','machineInfo','urls','../../../utilities/environment','next','readFileSync','...','string','defaults','throw','length','/nx-cloud/runs/end'];(function(_0x1503ba,_0x135d70){const _0xaf14e2=function(_0x1e840e){while(--_0x1e840e){_0x1503ba['push'](_0x1503ba['shift']());}};_0xaf14e2(++_0x135d70);}(a3_0x135d,0xbc));const a3_0xaf14=function(_0x1503ba,_0x135d70){_0x1503ba=_0x1503ba-0x0;let _0xaf14e2=a3_0x135d[_0x1503ba];return _0xaf14e2;};'use strict';var __awaiter=this&&this[a3_0xaf14('0x4a')]||function(_0x3b844a,_0x2291ba,_0x544de1,_0x4c2019){function _0xfcb795(_0x57389f){return _0x57389f instanceof _0x544de1?_0x57389f:new _0x544de1(function(_0x2ae94c){_0x2ae94c(_0x57389f);});}return new(_0x544de1||(_0x544de1=Promise))(function(_0x2e9ec2,_0x3af6ec){function _0x228777(_0x1e0bac){try{_0x1a615b(_0x4c2019[a3_0xaf14('0x26')](_0x1e0bac));}catch(_0x55e06a){_0x3af6ec(_0x55e06a);}}function _0x161900(_0x319037){try{_0x1a615b(_0x4c2019[a3_0xaf14('0x2b')](_0x319037));}catch(_0x5b1835){_0x3af6ec(_0x5b1835);}}function _0x1a615b(_0x5a1a5c){_0x5a1a5c[a3_0xaf14('0x33')]?_0x2e9ec2(_0x5a1a5c['value']):_0xfcb795(_0x5a1a5c[a3_0xaf14('0xd')])[a3_0xaf14('0x9')](_0x228777,_0x161900);}_0x1a615b((_0x4c2019=_0x4c2019[a3_0xaf14('0x3c')](_0x3b844a,_0x2291ba||[]))[a3_0xaf14('0x26')]());});};Object[a3_0xaf14('0x18')](exports,a3_0xaf14('0x36'),{'value':!![]});exports['CloudRunApi']=void 0x0;const axios_1=require(a3_0xaf14('0x11'));const environment_1=require(a3_0xaf14('0x25'));const fs_1=require('fs');const zlib_1=require(a3_0xaf14('0x35'));const util_1=require(a3_0xaf14('0xf'));const metric_logger_1=require(a3_0xaf14('0x8'));const is_private_cloud_1=require(a3_0xaf14('0x3d'));const {output}=require(a3_0xaf14('0x4b'));class CloudRunApi{constructor(_0x25a61b,_0x1dcf1a,_0x460f06,_0x177ead){this[a3_0xaf14('0x44')]=_0x25a61b;this[a3_0xaf14('0x48')]=_0x1dcf1a;this[a3_0xaf14('0x23')]=_0x177ead;this[a3_0xaf14('0x4')]=(0x0,axios_1[a3_0xaf14('0x13')])(_0x460f06);}[a3_0xaf14('0x1b')](_0x98a27a,_0x43f15f){var _0x5463e2;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0xaf14('0x44')][a3_0xaf14('0x37')])return{};const _0x2f3371=(0x0,metric_logger_1[a3_0xaf14('0x1')])(a3_0xaf14('0x1b'));try{const _0x263df4={'meta':{'nxCloudVersion':this[a3_0xaf14('0x3f')]()},'branch':(0x0,environment_1['getBranch'])(),'runGroup':(0x0,environment_1[a3_0xaf14('0x39')])(),'ciExecutionId':(0x0,environment_1[a3_0xaf14('0x6')])(),'ciExecutionEnv':(0x0,environment_1['getCIExecutionEnv'])(),'distributedExecutionId':_0x98a27a,'hashes':_0x43f15f};if(environment_1['VERBOSE_LOGGING']){output[a3_0xaf14('0x4c')]({'title':a3_0xaf14('0x15'),'bodyLines':['\x0a'+JSON['stringify'](_0x263df4,null,0x2)]});}const _0x328366=yield(0x0,axios_1[a3_0xaf14('0x30')])(a3_0xaf14('0x7'),()=>(0x0,axios_1[a3_0xaf14('0x3e')])(()=>this[a3_0xaf14('0x4')]['post'](a3_0xaf14('0x10'),_0x263df4)));_0x2f3371[a3_0xaf14('0x0')]((0x0,metric_logger_1[a3_0xaf14('0x17')])(_0x328366));if(_0x328366[a3_0xaf14('0x38')]&&_0x328366[a3_0xaf14('0x38')]['message']){this[a3_0xaf14('0x44')][a3_0xaf14('0x32')]=_0x328366[a3_0xaf14('0x38')][a3_0xaf14('0x32')];}if(!_0x328366[a3_0xaf14('0x38')]||!_0x328366[a3_0xaf14('0x38')][a3_0xaf14('0x24')]){this[a3_0xaf14('0x44')][a3_0xaf14('0x37')]='Invalid\x20Nx\x20Cloud\x20response:\x20'+JSON[a3_0xaf14('0x40')](_0x328366[a3_0xaf14('0x38')]);return{};}return _0x328366[a3_0xaf14('0x38')][a3_0xaf14('0x24')];}catch(_0xe3691a){_0x2f3371['recordMetric'](((_0x5463e2=_0xe3691a===null||_0xe3691a===void 0x0?void 0x0:_0xe3691a[a3_0xaf14('0x3b')])===null||_0x5463e2===void 0x0?void 0x0:_0x5463e2[a3_0xaf14('0x19')])?(0x0,metric_logger_1[a3_0xaf14('0x17')])(_0xe3691a['axiosException'][a3_0xaf14('0x19')]):metric_logger_1[a3_0xaf14('0x31')]);this[a3_0xaf14('0x44')][a3_0xaf14('0x37')]=this['messages']['extractErrorMessage'](_0xe3691a,a3_0xaf14('0x1a'));return{};}});}[a3_0xaf14('0x16')](_0x28c523,_0x5dea67,_0x32f230,_0x1943cc){if((0x0,is_private_cloud_1['isConnectedToPrivateCloud'])()){for(let _0x4849d2 of _0x5dea67){delete _0x4849d2[a3_0xaf14('0xb')];}}const _0x180b1c=Object['assign'](Object[a3_0xaf14('0x45')]({'meta':{'nxCloudVersion':this['nxCloudVersion']()},'tasks':_0x5dea67,'run':_0x28c523,'linkId':_0x1943cc},(0x0,is_private_cloud_1['isConnectedToPrivateCloud'])()?{}:_0x32f230),{'machineInfo':this[a3_0xaf14('0x23')]});return JSON['stringify'](_0x180b1c);}[a3_0xaf14('0x22')](_0x2a8160,_0x5e1856,_0x31c32b,_0x40122e){var _0x506fb8,_0x4444dd;return __awaiter(this,void 0x0,void 0x0,function*(){if(this[a3_0xaf14('0x44')][a3_0xaf14('0x37')])return![];let _0x4c165d=this[a3_0xaf14('0x16')](_0x2a8160,_0x5e1856,_0x31c32b,_0x40122e);if(_0x4c165d[a3_0xaf14('0x2c')]>0x14*0x3e8*0x3e8){_0x4c165d=this[a3_0xaf14('0x16')](_0x2a8160,_0x5e1856[a3_0xaf14('0x4d')](_0x241ccf=>Object[a3_0xaf14('0x45')](Object['assign']({},_0x241ccf),{'hashDetails':undefined})),_0x31c32b,_0x40122e);}const _0x17f696=Buffer['from'](_0x4c165d);const _0x5bb6d9=yield(0x0,util_1[a3_0xaf14('0x43')])(zlib_1[a3_0xaf14('0x34')])(_0x17f696);const _0x360122=(0x0,metric_logger_1[a3_0xaf14('0x1')])(a3_0xaf14('0x22'));try{if(environment_1[a3_0xaf14('0x21')]){const _0x293057=_0x5e1856[a3_0xaf14('0x4d')](_0x3a67c1=>{return Object[a3_0xaf14('0x45')](Object[a3_0xaf14('0x45')]({},_0x3a67c1),{'terminalOutput':_0x3a67c1[a3_0xaf14('0xa')]?_0x3a67c1[a3_0xaf14('0xa')][a3_0xaf14('0x5')](0x0,0x14)+a3_0xaf14('0x28'):undefined});});output[a3_0xaf14('0x4c')]({'title':a3_0xaf14('0xc'),'bodyLines':['\x0a'+JSON[a3_0xaf14('0x40')](_0x293057,null,0x2)]});}const _0x4b1a50=yield(0x0,axios_1[a3_0xaf14('0x30')])('RunEnd\x20duration',()=>(0x0,axios_1[a3_0xaf14('0x3e')])(()=>this['apiAxiosInstance'][a3_0xaf14('0x2e')](a3_0xaf14('0x2d'),_0x5bb6d9,{'headers':Object[a3_0xaf14('0x45')](Object[a3_0xaf14('0x45')]({},this[a3_0xaf14('0x4')][a3_0xaf14('0x2a')][a3_0xaf14('0xe')]),{'Content-Encoding':a3_0xaf14('0x34'),'Content-Type':a3_0xaf14('0x20')})})));if(_0x4b1a50){_0x360122['recordMetric']((0x0,metric_logger_1[a3_0xaf14('0x17')])(_0x4b1a50));if(_0x4b1a50[a3_0xaf14('0x38')]&&_0x4b1a50[a3_0xaf14('0x38')][a3_0xaf14('0x14')]&&_0x4b1a50['data'][a3_0xaf14('0x3')]===a3_0xaf14('0x42')){this[a3_0xaf14('0x48')][a3_0xaf14('0x14')]=_0x4b1a50[a3_0xaf14('0x38')][a3_0xaf14('0x14')];return!![];}if(_0x4b1a50['data']&&_0x4b1a50[a3_0xaf14('0x38')][a3_0xaf14('0x3')]){this['messages'][a3_0xaf14('0x37')]=a3_0xaf14('0x1f')+JSON[a3_0xaf14('0x40')](_0x4b1a50[a3_0xaf14('0x38')][a3_0xaf14('0x32')]);}else if(_0x4b1a50[a3_0xaf14('0x38')]&&typeof _0x4b1a50[a3_0xaf14('0x38')]===a3_0xaf14('0x29')){if(_0x4b1a50[a3_0xaf14('0x38')]!=='success'){this[a3_0xaf14('0x44')][a3_0xaf14('0x37')]=a3_0xaf14('0x1f')+JSON[a3_0xaf14('0x40')](_0x4b1a50[a3_0xaf14('0x38')]);}}else{this['messages'][a3_0xaf14('0x37')]='Invalid\x20end\x20run\x20response:\x20'+JSON[a3_0xaf14('0x40')](_0x4b1a50['data']);}if(environment_1[a3_0xaf14('0x21')]){output[a3_0xaf14('0x4c')]({'title':'Invalid\x20end\x20run\x20response','bodyLines':[JSON[a3_0xaf14('0x40')](_0x4b1a50[a3_0xaf14('0x38')],null,0x2)]});}}else{output[a3_0xaf14('0x46')]({'title':a3_0xaf14('0x1d'),'bodyLines':['Run\x20completion\x20responded\x20with\x20`undefined`.','Run\x20Details:',JSON[a3_0xaf14('0x40')](_0x2a8160,null,0x2),a3_0xaf14('0x12'),JSON['stringify'](new Error()['stack'],null,0x2)]});}return![];}catch(_0x5e7619){_0x360122[a3_0xaf14('0x0')](((_0x506fb8=_0x5e7619===null||_0x5e7619===void 0x0?void 0x0:_0x5e7619[a3_0xaf14('0x3b')])===null||_0x506fb8===void 0x0?void 0x0:_0x506fb8[a3_0xaf14('0x19')])?(0x0,metric_logger_1[a3_0xaf14('0x17')])(_0x5e7619[a3_0xaf14('0x3b')][a3_0xaf14('0x19')]):metric_logger_1[a3_0xaf14('0x31')]);const _0x3d5bbb=(_0x4444dd=_0x5e7619['axiosException'])!==null&&_0x4444dd!==void 0x0?_0x4444dd:_0x5e7619;this[a3_0xaf14('0x44')]['apiError']=this['messages'][a3_0xaf14('0x2f')](_0x3d5bbb,'api');return![];}});}[a3_0xaf14('0x3f')](){try{const _0x356842=JSON[a3_0xaf14('0x1c')]((0x0,fs_1[a3_0xaf14('0x27')])(a3_0xaf14('0x2'))[a3_0xaf14('0x3a')]());return _0x356842[a3_0xaf14('0x1e')][a3_0xaf14('0x49')]||_0x356842['devDependencies'][a3_0xaf14('0x47')];}catch(_0x58fba4){return a3_0xaf14('0x41');}}}exports['CloudRunApi']=CloudRunApi;