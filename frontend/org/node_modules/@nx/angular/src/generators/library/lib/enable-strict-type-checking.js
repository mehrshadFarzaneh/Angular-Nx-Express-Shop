"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.setLibraryStrictDefault = exports.enableStrictTypeChecking = void 0;
const devkit_1 = require("@nx/devkit");
/**
 * Enable Strict Mode in the library and spec TS Config
 * */
function enableStrictTypeChecking(host, options) {
    updateTsConfig(host, options);
}
exports.enableStrictTypeChecking = enableStrictTypeChecking;
function setLibraryStrictDefault(host, isStrict) {
    var _a;
    // set the default so future libraries use it
    // unless the user has previously set this value
    const nxJson = (0, devkit_1.readNxJson)(host);
    nxJson.generators = nxJson.generators || {};
    nxJson.generators['@nx/angular:library'] =
        nxJson.generators['@nx/angular:library'] || {};
    nxJson.generators['@nx/angular:library'].strict =
        (_a = nxJson.generators['@nx/angular:library'].strict) !== null && _a !== void 0 ? _a : isStrict;
    (0, devkit_1.updateNxJson)(host, nxJson);
}
exports.setLibraryStrictDefault = setLibraryStrictDefault;
function updateTsConfig(host, options) {
    // Update the settings in the tsconfig.app.json to enable strict type checking.
    // This matches the settings defined by the Angular CL https://angular.io/guide/strict-mode
    (0, devkit_1.updateJson)(host, `${options.projectRoot}/tsconfig.json`, (json) => {
        var _a, _b;
        // update the TypeScript settings
        json.compilerOptions = Object.assign(Object.assign({}, ((_a = json.compilerOptions) !== null && _a !== void 0 ? _a : {})), { forceConsistentCasingInFileNames: true, strict: true, noImplicitOverride: true, noPropertyAccessFromIndexSignature: true, noImplicitReturns: true, noFallthroughCasesInSwitch: true });
        // update Angular Template Settings
        json.angularCompilerOptions = Object.assign(Object.assign({}, ((_b = json.angularCompilerOptions) !== null && _b !== void 0 ? _b : {})), { enableI18nLegacyMessageIdFormat: false, strictInjectionParameters: true, strictInputAccessModifiers: true, strictTemplates: true });
        return json;
    });
}
