"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const devkit_1 = require("@nx/devkit");
function removeLibraryGeneratorSimpleModuleNameOption(tree) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const nxJson = (0, devkit_1.readNxJson)(tree);
        // update global config
        const nxJsonUpdated = replaceSimpleModuleNameInConfig(nxJson);
        if (nxJsonUpdated) {
            (0, devkit_1.updateNxJson)(tree, nxJson);
        }
        // update project configs
        const projects = (0, devkit_1.getProjects)(tree);
        for (const [name, project] of projects) {
            const projectUpdated = replaceSimpleModuleNameInConfig(project);
            if (projectUpdated) {
                (0, devkit_1.updateProjectConfiguration)(tree, name, project);
            }
        }
        yield (0, devkit_1.formatFiles)(tree);
    });
}
exports.default = removeLibraryGeneratorSimpleModuleNameOption;
function replaceSimpleModuleNameInConfig(configObject) {
    var _a, _b, _c, _d, _e;
    var _f, _g;
    if (!(configObject === null || configObject === void 0 ? void 0 : configObject.generators)) {
        return false;
    }
    let updated = false;
    if ((_b = (_a = configObject.generators['@nrwl/angular']) === null || _a === void 0 ? void 0 : _a['library']) === null || _b === void 0 ? void 0 : _b.simpleModuleName) {
        (_c = (_f = configObject.generators['@nrwl/angular']['library']).simpleName) !== null && _c !== void 0 ? _c : (_f.simpleName = configObject.generators['@nrwl/angular']['library'].simpleModuleName);
        delete configObject.generators['@nrwl/angular']['library'].simpleModuleName;
        updated = true;
    }
    else if ((_d = configObject.generators['@nrwl/angular:library']) === null || _d === void 0 ? void 0 : _d.simpleModuleName) {
        (_e = (_g = configObject.generators['@nrwl/angular:library']).simpleName) !== null && _e !== void 0 ? _e : (_g.simpleName = configObject.generators['@nrwl/angular:library'].simpleModuleName);
        delete configObject.generators['@nrwl/angular:library'].simpleModuleName;
        updated = true;
    }
    return updated;
}
